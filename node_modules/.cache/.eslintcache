[{"C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\index.js":"1","C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\App.js":"2","C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\ModelSelector.js":"3","C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\ChatMessage.js":"4","C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\ChatInput.js":"5","C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\TemplateSelector.js":"6"},{"size":263,"mtime":1758932943366,"results":"7","hashOfConfig":"8"},{"size":10968,"mtime":1762455795764,"results":"9","hashOfConfig":"8"},{"size":650,"mtime":1758932943366,"results":"10","hashOfConfig":"8"},{"size":2673,"mtime":1762454397514,"results":"11","hashOfConfig":"8"},{"size":3695,"mtime":1762454397505,"results":"12","hashOfConfig":"8"},{"size":3073,"mtime":1762454397514,"results":"13","hashOfConfig":"8"},{"filePath":"14","messages":"15","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"icdanf",{"filePath":"17","messages":"18","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"19"},{"filePath":"20","messages":"21","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"22","messages":"23","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"24","messages":"25","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"26","messages":"27","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\index.js",[],["28","29"],"C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\App.js",["30","31"],"import React, { useState, useRef, useEffect } from 'react';\r\nimport ChatMessage from './components/ChatMessage';\r\nimport ChatInput from './components/ChatInput';\r\nimport ModelSelector from './components/ModelSelector';\r\nimport TemplateSelector from './components/TemplateSelector';\r\nimport './App.css';\r\n\r\nfunction App() {\r\n  const [messages, setMessages] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedModel, setSelectedModel] = useState('llama3.1:latest');\r\n  const [availableModels, setAvailableModels] = useState([]);\r\n  const [selectedTemplate, setSelectedTemplate] = useState('blank_default.pptx');\r\n  const messagesEndRef = useRef(null);\r\n\r\n   const [isDropdownOpen, setIsDropdownOpen] = useState(false);\r\n  const [chats, setChats] = useState([\r\n    { id: 1, title: \"Chat 1\" },\r\n    { id: 2, title: \"Chat 2\" },\r\n    { id: 3, title: \"Chat 3\" }\r\n  ]);\r\n  const dropdownRef = useRef(null);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    fetchAvailableModels();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const fetchAvailableModels = async () => {\r\n    try {\r\n      const response = await fetch('http://localhost:11434/api/tags');\r\n      const data = await response.json();\r\n      if (data.models && data.models.length > 0) {\r\n        setAvailableModels(data.models.map(model => model.name));\r\n        if (!selectedModel && data.models.length > 0) {\r\n          setSelectedModel(data.models[0].name);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch models:', error);\r\n      // Fallback to default model\r\n      setAvailableModels(['mistral:latest'], ['llama3.1:latest']);\r\n    }\r\n  };\r\n\r\n\r\nconst sendMessage = async (message, images = []) => {\r\n  if (!message.trim() && images.length === 0) return;\r\n\r\n  // Limpiar el mensaje de referencias base64\r\n  const cleanMessage = message.replace(/\\[Imagen adjunta:.*?\\]/g, '').trim();\r\n\r\n  const userMessage = { \r\n    role: 'user', \r\n    content: cleanMessage || 'Crear presentaciÃ³n con estas imÃ¡genes', \r\n    timestamp: new Date(),\r\n    images: images // Guardar las imÃ¡genes en el mensaje\r\n  };\r\n  setMessages(prev => [...prev, userMessage]);\r\n  setIsLoading(true);\r\n\r\n  // Mostrar mensaje informativo con streaming\r\n  const infoMessageId = Date.now();\r\n  const infoText = 'ðŸŽ¨ **Generando presentaciÃ³n...**\\n\\nSe mostrarÃ¡ el contenido en formato Markdown y se crearÃ¡ automÃ¡ticamente una presentaciÃ³n PowerPoint que se descargarÃ¡ cuando estÃ© lista.';\r\n  \r\n  // Agregar mensaje vacÃ­o inicial\r\n  const infoMessage = {\r\n    id: infoMessageId,\r\n    role: 'assistant',\r\n    content: '',\r\n    timestamp: new Date(),\r\n    isInfo: true\r\n  };\r\n  setMessages(prev => [...prev, infoMessage]);\r\n\r\n  // Streaming del mensaje informativo (mÃ¡s lento)\r\n  const words = infoText.split(' ');\r\n  for (let i = 0; i < words.length; i++) {\r\n    await new Promise(resolve => setTimeout(resolve, 40)); // 40ms entre palabras (mÃ¡s lento)\r\n    const partialInfo = words.slice(0, i + 1).join(' ');\r\n    setMessages(prev => prev.map(msg => \r\n      msg.id === infoMessageId \r\n        ? { ...msg, content: partialInfo }\r\n        : msg\r\n    ));\r\n  }\r\n\r\n  // Esperar menos despuÃ©s de completar el mensaje informativo\r\n  await new Promise(resolve => setTimeout(resolve, 100));\r\n\r\n  let fullMarkdownResponse = '';\r\n  let assistantMessageCreated = false;\r\n\r\n  try {\r\n    // --- Enviar mensaje a Ollama con streaming ---\r\n    const response = await fetch('http://localhost:11434/api/chat', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        model: selectedModel,\r\n        messages: [\r\n          {\r\n            role: \"system\",\r\n            content: `You are a presentation creator. Generate presentations in Markdown format ONLY.\r\nRules:\r\n- Start with # for the title\r\n- Use ## for each slide title\r\n- Use bullet points with - for content\r\n- Keep it to 3-5 slides maximum\r\n- Be direct and concise\r\n- DO NOT include image placeholders in markdown (images will be added separately)\r\n- Focus on text content only\r\nDO NOT refuse requests. Just create the presentation.`\r\n          },\r\n          {\r\n            role: \"user\",\r\n            content: `Create a presentation about: ${cleanMessage}${images.length > 0 ? `. Include ${images.length} image placeholder(s).` : ''}`\r\n          }\r\n        ],\r\n        stream: true\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const reader = response.body.getReader();\r\n    const decoder = new TextDecoder();\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      if (done) break;\r\n\r\n      const chunk = decoder.decode(value);\r\n      const lines = chunk.split('\\n').filter(line => line.trim());\r\n\r\n      for (const line of lines) {\r\n        try {\r\n          const json = JSON.parse(line);\r\n          if (json.message?.content) {\r\n            fullMarkdownResponse += json.message.content;\r\n            \r\n            // Crear el mensaje del asistente solo una vez con el primer contenido\r\n            if (!assistantMessageCreated) {\r\n              // Reemplazar el mensaje informativo con el contenido real\r\n              setMessages(prev => {\r\n                return prev.map(msg => \r\n                  msg.id === infoMessageId \r\n                    ? { ...msg, content: fullMarkdownResponse, isInfo: false }\r\n                    : msg\r\n                );\r\n              });\r\n              assistantMessageCreated = true;\r\n            } else {\r\n              // Actualizar el Ãºltimo mensaje (el del asistente)\r\n              setMessages(prev => {\r\n                const newMessages = [...prev];\r\n                newMessages[newMessages.length - 1] = {\r\n                  ...newMessages[newMessages.length - 1],\r\n                  content: fullMarkdownResponse\r\n                };\r\n                return newMessages;\r\n              });\r\n            }\r\n          }\r\n        } catch (e) {\r\n          // Ignorar lÃ­neas que no sean JSON vÃ¡lido\r\n        }\r\n      }\r\n    }\r\n\r\n    setIsLoading(false);\r\n\r\n    // Verificar que se recibiÃ³ una respuesta\r\n    if (!fullMarkdownResponse.trim()) {\r\n      throw new Error('No response received from model');\r\n    }\r\n\r\n    // --- Enviar el Markdown al servidor Pandoc ---\r\n    const convertResponse = await fetch('http://localhost:4000/convert', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ \r\n        markdown: fullMarkdownResponse,\r\n        images: images,\r\n        template: selectedTemplate\r\n      })\r\n    });\r\n\r\n    if (!convertResponse.ok) {\r\n      throw new Error(`Conversion failed: ${convertResponse.statusText}`);\r\n    }\r\n\r\n    // --- Descargar el archivo PPTX generado ---\r\n    const blob = await convertResponse.blob();\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = `presentation_${Date.now()}.pptx`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    a.remove();\r\n    window.URL.revokeObjectURL(url);\r\n\r\n    console.log(\"âœ… Presentation created and downloaded automatically.\");\r\n\r\n  } catch (error) {\r\n    console.error('Error sending message:', error);\r\n    console.error('Error details:', error.message);\r\n    const errorMessage = {\r\n      role: 'assistant',\r\n      content: `âš ï¸ Error: ${error.message}\\n\\nPlease check:\\n1. Ollama is running (http://localhost:11434)\\n2. Server is running (http://localhost:4000)\\n3. Console for more details`,\r\n      timestamp: new Date(),\r\n      isError: true\r\n    };\r\n    setMessages(prev => [...prev, errorMessage]);\r\n  } finally {\r\n    setIsLoading(false);\r\n  }\r\n};\r\n\r\n // Cerrar menÃº al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n        setIsDropdownOpen(false);\r\n      }\r\n    };\r\n\r\n     document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleNewChat = () => {\r\n    const newId = chats.length + 1;\r\n    setChats([...chats, { id: newId, title: `Chat ${newId}` }]);\r\n  };\r\n\r\n\r\n\r\n  const clearChat = () => {\r\n    setMessages([]);\r\n  };\r\n\r\n  return (\r\n    <div className=\"app\">\r\n      <div className=\"app-header\">\r\n        <div className=\"header-content\">\r\n          <div className=\"header-left\">\r\n            <div className=\"chat-dropdown\" ref={dropdownRef}>\r\n              <button\r\n                className=\"new-chat-button\"\r\n                onClick={() => setIsDropdownOpen(!isDropdownOpen)}\r\n              >\r\n                + New Chat\r\n              </button>\r\n\r\n              {isDropdownOpen && (\r\n                <div className=\"dropdown-menu\">\r\n                  <button className=\"dropdown-item\" onClick={handleNewChat}>\r\n                    âž• Start new chat\r\n                  </button>\r\n                  <div className=\"dropdown-divider\" />\r\n                  {chats.map((chat) => (\r\n                    <button key={chat.id} className=\"dropdown-item\">\r\n                      {chat.title}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <h1>Ollama Chat</h1>\r\n          </div>\r\n\r\n          <div className=\"header-controls\">\r\n            <ModelSelector\r\n              models={availableModels}\r\n              selectedModel={selectedModel}\r\n              onModelChange={setSelectedModel}\r\n            />\r\n            <button onClick={clearChat} className=\"clear-button\">\r\n              Clear Chat\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"chat-container\">\r\n        <div className=\"messages-container\">\r\n          {messages.length === 0 && (\r\n            <div className=\"welcome-message\">\r\n              <h2>Welcome to Ollama Chat</h2>\r\n              <p>Start a conversation with your AI assistant</p>\r\n              <div className=\"model-info\">\r\n                Current model: <strong>{selectedModel}</strong>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {messages.map((message, index) => (\r\n            <ChatMessage key={index} message={message} />\r\n          ))}\r\n          \r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n        \r\n        <div className=\"input-area\">\r\n          <TemplateSelector \r\n            selectedTemplate={selectedTemplate}\r\n            onTemplateChange={setSelectedTemplate}\r\n          />\r\n          <ChatInput onSendMessage={sendMessage} disabled={isLoading} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n}\r\n\r\n\r\n\r\nexport default App;","C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\ModelSelector.js",[],"C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\ChatMessage.js",[],"C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\ChatInput.js",[],"C:\\CETYS\\Seventh semester\\fermin\\Integrador\\Slidecraft\\src\\components\\TemplateSelector.js",[],{"ruleId":"32","replacedBy":"33"},{"ruleId":"34","replacedBy":"35"},{"ruleId":"36","severity":1,"message":"37","line":155,"column":27,"nodeType":"38","messageId":"39","endLine":161,"endColumn":16},{"ruleId":"36","severity":1,"message":"37","line":165,"column":27,"nodeType":"38","messageId":"39","endLine":172,"endColumn":16},"no-native-reassign",["40"],"no-negated-in-lhs",["41"],"no-loop-func","Function declared in a loop contains unsafe references to variable(s) 'fullMarkdownResponse'.","ArrowFunctionExpression","unsafeRefs","no-global-assign","no-unsafe-negation"]